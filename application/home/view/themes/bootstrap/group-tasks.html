{extend name="home@themes/bootstrap/layout-group/group-layout" /}
{block name='title_block'}{$lang.tasks} - {$group->name}{/block}
{block name='body'}
<script src="/static/laydate/laydate.js"></script>


<div class="container">

    <div class="row">
        <div class="container">
            {if $group->owner_id == $login_user->user_id}
            <button class="btn btn-success" type="button" onclick="open_add_task();"><span
                    class="glyphicon glyphicon-plus"></span> {$lang.add_homework}
            </button>
            {/if}
            <a class="btn btn-success" href="/groups/{$group->id}/members/{$login_user->user_id}/source_codes/download"><span
                    class="glyphicon glyphicon-download"></span> {$lang.download} {$lang.source_code}</a>
        </div>
    </div>
    <table class="table table-hover">
        <thead>
        <tr>
            <th>{$lang.title}</th>
            {if $group->owner_id == $login_user->user_id}
            <th><?php echo ['en' => 'Member Complete Rate', 'cn' => '学生完成率'][$show_ui_lang];?></th>
            {else}
            <th>{$lang.status}</th>
            {/if}
            <th></th>
            <th>{$lang.operation}</th>
        </tr>
        </thead>
        <tbody>
        {volist name='tasks' id='task'}
        <tr>
            <td><a href="/contests/{$task->contest_id}" target="_blank">{$task->contest->title}</a></td>
            <td>
                <div class="progress">
                    {if $group->owner_id == $login_user->user_id}
                    {if $task->ac_member_cnt == $group_member_cnt}
                    {if 0 == $group_member_cnt}
                    <div class="progress-bar"
                         style="width: 0%;">
                    </div>
                    {else}
                    <div class="progress-bar progress-bar-success" style="width: {$task->ac_member_cnt * 100.00 / $group_member_cnt}%;"></div>
                    {/if}
                    {else}
                    {if 0 == $group_member_cnt}
                    <div class="progress-bar"
                         style="width: 0%;">
                    </div>
                    {else}
                    <div class="progress-bar"
                         style="width: {$task->ac_member_cnt * 100.00 / $group_member_cnt}%;">
                    </div>
                    {/if}
                    {/if}
                    {else}
                    {if $task->contest->login_user_ac_cnt == $task->contest->problem_cnt}
                    {if $task->contest->problem_cnt == 0}
                    <div class="progress-bar"
                         style="width: 0%;">
                    </div>
                    {else}
                    <div class="progress-bar progress-bar-success"
                         style="width: {$task->contest->login_user_ac_cnt * 100.00 / $task->contest->problem_cnt}%;">
                    </div>
                    {/if}
                    {else}
                    {if 0 == $task->contest->problem_cnt}
                    <div class="progress-bar"
                         style="width: 0%;">
                    </div>
                    {else}
                    <div class="progress-bar"
                         style="width: {$task->contest->login_user_ac_cnt * 100.00 / $task->contest->problem_cnt}%;">
                    </div>
                    {/if}
                    {/if}
                    {/if}
                </div>
            </td>
            <td>
                {if $group->owner_id == $login_user->user_id}
                {$task->ac_member_cnt} / {$group_member_cnt}
                {else}
                {$task->contest->login_user_ac_cnt} / {$task->contest->problem_cnt}
                {/if}
            </td>
            <td>
                <a class="btn btn-sm btn-success"
                   href="/contest/rank/export_group_contest_xls?id={$task->contest->contest_id}&group_id={$group->id}">下载成绩</a>
                {if $group->owner_id == $login_user->user_id}
                <a class="btn btn-sm btn-danger" onclick="delete_task('{$task->contest->title}', {$task->id});"
                   href="javascript:">删除</a>
                {/if}
            </td>
        </tr>
        {/volist}
        </tbody>
    </table>
</div>


<!--添加作业之模态框 begin-->
<div class="modal fade" id="addTaskModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 class="modal-title" id="editContestModalLabel">{$lang.add_homework}</h4>
            </div>
            <div class="modal-body">
                <div data-spy="scroll" data-target="#navbar-edit-contest" data-offset="0"
                     class="scrollspy-edit-contest">
                    <div class="card-block">
                        <div class="form-group row">
                            <label for="contest-title" class="col-xs-2 col-form-label">{$lang.title}</label>
                            <div class="col-xs-10">
                                <input class="form-control" type="text" id="contest-title"
                                       placeholder="eg: 信息安全111班-数据结构-栈">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="contest-begin-time" class="col-xs-2 col-form-label">{$lang.start_time}</label>
                            <div class="col-xs-10">
                                <input class="form-control" type="text" id="contest-begin-time"
                                       placeholder="请选择开始时间">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="contest-end-time" class="col-xs-2 col-form-label">{$lang.end_time}</label>
                            <div class="col-xs-10">
                                <input class="form-control" type="text" id="contest-end-time"
                                       placeholder="请选择结束时间">
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="contest-description-edit"
                               class="col-xs-2 col-form-label">{$lang.description}</label>
                        <div class="col-xs-10">
							<textarea class="form-control" name="description" id="contest-description-edit" rows="5"
                                      data-original-title="" title=""></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="contest-description-edit" class="col-xs-2 col-form-label">{$lang.problem}</label>
                        <div class="col-xs-7">
                            <input class="form-control" type="text" id="problem-ids"
                                   placeholder="eg: 1000,1001">
                        </div>
                        <div class="col-xs-3">
                            <a class="btn btn-success" href="javascript:;" onclick="preview_problems()">{$lang.preview_problems}</a>
                        </div>
                    </div>
                </div>
                <h4 id="panel-problems"></h4>
                <div class="card-block" id="card-problems">
                    <div class="alert alert-warning" id="info-problem-set-fixed" hidden>
                        You can't change problem set after contest starts.
                    </div>

                    <table id="addTable" class="sorted_table table table-hover">
                        <thead>
                        <tr>
                            <th>{$lang.problem_id}</th>
                            <th>{$lang.title}</th>
                        </tr>
                        </thead>
                        <tbody id="task-list">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="modal-footer">
                <div class="alert alert-danger" role="alert" id="edit-alert" style="display: none"></div>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="btn-confirm" onclick="add_task()">Confirm</button>
            </div>
        </div>
    </div>
</div>
<!--添加作业之模态框 end-->

<script type="text/javascript">
    function open_create_homework_page() {
        layer.open({
            type: 2,
            title: '创建作业',
            area: ['800px', '600px'],
            content: '/groups/{$group->id}/tasks/create'
        });
    }

    function open_copy_homeworks_from_group() {
        layer.open({
            type: 2,
            title: '复制班级所有作业',
            area: ['800px', '600px'],
            content: '/groups/{$group->id}/tasks/copy/group'
        });
    }

    function open_copy_homework_from_homework() {
        layer.open({
            type: 2,
            title: '复制作业',
            area: ['800px', '600px'],
            content: '/groups/{$group->id}/tasks/copy/homework'
        });
    }

    function open_add_task() {
        layer.open({
            title: '添加方式',
            shadeClose: true,
            content: '请选择添加作业方式',
            btn: ['手动添加', '复制班级', '复制作业'],
            btn1: function (index, layero) {
                layer.closeAll();
                open_create_homework_page();
            },
            btn2: function (index, layero) {
                layer.closeAll();
                open_copy_homeworks_from_group();
            },
            btn3: function (index, layero) {
                layer.closeAll();
                open_copy_homework_from_homework();
            },
        });
    }
</script>
{/block}
