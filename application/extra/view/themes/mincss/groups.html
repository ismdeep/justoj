{extend name="extra@themes/mincss/layout/user" /}
{block name='titlepart'}{$lang['allgroup']} :: Welcome to JustOJ{/block}
{block name="body"}
<div class="container">
	<form class="form-horizontal" action="/groups" method="get">
		<p>
			<input class="form-control" style="border-radius: 0px" type="text" name="keyword" value="{$keyword}" placeholder="{$lang.search}: {$lang.name}">
			<button class="btn btn-sm"> <span class="glyphicon glyphicon-search"></span> {$lang.search}</button>
		</p>
	</form>

	<table class="table">
		<thead>
		<tr>
			<th width="40%">{$lang.name}</th>
			<th width="35%">{$lang.teacher}</th>
			<th width="10%">{$lang.operation}</th>
		</tr>
		</thead>
		<tbody>
		{volist name='groups' id='group'}
		<?php $group->fk();?>
		<tr>
			<td><a href="/group?id={$group->id}">{if 1 == $group->type}&nbsp;{/if}{$group->name}</a></td>
			<td>{$group->ownner_id}({$group->teacher->nick})</td>
			<td>
				{if $group->loginuser_group_join}
					{if 0 == $group->loginuser_group_join->status}
					{$lang.waiting_for_verify}
					{/if}

					{if 1 == $group->loginuser_group_join->status}
					<a href="/group?id={$group->loginuser_group_join->group_id}">{$lang.enter}</a>
					{/if}

					{if 2 == $group->loginuser_group_join->status}
					<span class="label label-danger">{$lang.removed}</span>
					{/if}

					{if 3 == $group->loginuser_group_join->status}
					<span class="label label-danger">{$lang.rejected}</span>
					{/if}
				{else}
				<a href="/group/Join?id={$group->id}">{$lang.join}</a>
				{/if}
			</td>
		</tr>
		{/volist}
		</tbody>
	</table>
	{$groups->render()}
</div>


<style>
	.pagination {
		display: inline-block;
		padding-left: 0;
		margin: 0px 0;
		border-radius: 4px;
	}
	.table {
		width: 100%;
		max-width: 100%;
		margin-bottom: 0px;
	}
</style>

<script type="text/javascript">
function request_join(group_id){
    layer.confirm('确定申请加入此班级？',function(index){
        layer.close(index);
        var data = {
            'group_id': group_id
		};
        $.post('/api/Group/join',data,function(d){
            if ('success' == d.status) {
                location.reload();
			}else{
                layer.alert(d.msg);
			}
		},'json');
	});
}
</script>
{/block}
