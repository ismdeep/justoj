{extend name="extra@themes/mincss/layout-contest/contest-layout" /}
{block name='titlepart'}{$alphabet[$contest_problem->num]}:{$problem->title} - {$contest->title} - 江西理工大学编程俱乐部{/block}
{block name="body"}
<div class="container">
	<ul class="pagination">
		{volist name='contest_problems' id='p'}
		<li>
			<a {if $contest_problem->num == $p->num}style="color:black;"{/if} href="/contest/Problem?id={$contest->contest_id}&pid={$p->num}">{if $p->ac}<span style="color: green">√</span>{/if}
		{if $p->pending}<span style="color: red">--</span>&nbsp;{/if}{$alphabet[$p->num]}</a>&nbsp;&nbsp;&nbsp;
		</li>
		{/volist}
	</ul>
	<br>
	<h2 align="center">
		{if $contest_problem->ac}
		<span style="color: green">√</span>
		{/if}
		{if $contest_problem->pending}
		<span style="color: red">--</span>
		{/if}
		{$alphabet[$contest_problem->num]}: {$problem->title}</h2>
	<div align="center">
		<div>
			<span class=green>{$lang.time_limit}: </span>{$problem->time_limit} s &nbsp;&nbsp;&nbsp;&nbsp;
			<span class=green>{$lang.memory_limit}: </span>{$problem->memory_limit} MB &nbsp;&nbsp;&nbsp;&nbsp;
			{if $loginuser}
			<a href="/contest/Status?id={$contest->contest_id}&run_id=&username={$loginuser->user_id}&problem_id={$contest_problem->num}" target="_blank" type="button">{$lang.my_status}</a> &nbsp;&nbsp;&nbsp;&nbsp;
			{/if}
			{if $is_administrator}
			<a href="/admin/Problem/edit?id={$problem->problem_id}" target="_blank">{$lang.edit}</a> &nbsp;&nbsp;&nbsp;&nbsp;
			<a href="/admin/Problem/files?problem_id={$problem->problem_id}" target="_blank">{$lang.test_data}</a>
			{/if}
		</div>
	</div>
	<h3>{$lang.problem_description}</h3>
	<div class="content">
		{$problem->description}
	</div>
	<h3>{$lang.input}</h3>
	<div class=content>{$problem->input}</div>
	<h3>{$lang.output}</h3>
	<div class=content>{$problem->output}</div>
	<h3>{$lang.sample_input}</h3>
	<pre><span class=sampledata>{$problem->sample_input}</span></pre>
	<h3>{$lang.sample_output}</h3>
	<pre><span class=sampledata>{$problem->sample_output}</span></pre>
	<h3>{$lang.hint}</h3>
	<div>{$problem->hint}</div>
	<h3>{$lang.source}</h3>
	<div class=content>
		<p><a href='/problem/search?source={$problem->source}'>{$problem->source}</a></p>
	</div>
	<div class="content">
		<a href="/problem?id={$problem->problem_id}" target="_blank">Original Problem Link</a>
	</div>

	<form method="post" onsubmit="return submit_code();">
		<p><span>{$lang.language}：</span><select name="language" id="submit-language">{volist name="allowed_langs" id="item"}<option value="{$item.id}">{$item.name} ({$item.version})</option>{/volist}</select></p>
		<p><textarea class="form-control" style="font-family: Consolas,Courier,monospace;width: 60%" name="source" id="submit-source" rows="15"></textarea></p>
		<p><button type="submit">{$lang.submit}</button>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red" id="error-info"></span><span id="judge-info"></span></p>
	</form>
</div>

<script type="text/javascript">
	var solution_result_color = {
		'result_code_pending': 'black',
		'result_code_rejuding': 'black',
		'result_code_compiling': 'black',
		'result_code_running': 'black',
		'result_code_ac': 'green',
		'result_code_pe': 'black',
		'result_code_wa': 'red',
		'result_code_tle': 'red',
		'result_code_mle': 'red',
		'result_code_ole': 'red',
		'result_code_re': 'red',
		'result_code_ce': 'red',
		'result_code_co': 'black',
		'result_code_tr': 'black',
		'result_code_so': 'black'
	};


	function getNowFormatDate() {
		var date = new Date();
		var seperator1 = "-";
		var seperator2 = ":";
		var month = date.getMonth() + 1;
		var strDate = date.getDate();
		if (month >= 1 && month <= 9) {
			month = "0" + month;
		}
		if (strDate >= 0 && strDate <= 9) {
			strDate = "0" + strDate;
		}

		var hour = date.getHours();
		var minute = date.getMinutes();
		var second = date.getSeconds();

		var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate + " ";
		if (hour < 10) currentdate += '0';
		currentdate += hour + seperator2;
		if (minute < 10) currentdate += '0';
		currentdate += minute + seperator2;
		if (second < 10) currentdate += '0';
		currentdate += second;
		//+ date.getHours() + seperator2 + date.getMinutes() + seperator2 + date.getSeconds();
		return currentdate;
	}

	function status_monitor(){
		$.get('/api/solution/status?solution_id='+solution_id,function(d){
			if (d.data.result < 4) {
				$('#judge-info').html(d.data.result_text);
				window.setTimeout("status_monitor()",300);
			}else{
				$('#judge-info').html(d.data.result_text);
				$('#judge-info').css('color', solution_result_color[d.data.result_code]);
				/* 如果是编译错误还要显示编译错误信息 */
				// if ('11' == d.data.result) {
				// 	$('#solution-compile-error').html(d.data.compile_info.error);
				// 	$('#compile-info-panel').show();
				// }
				// if ('4' == d.data.result) {
				// $('#submit-source').val('');
				// }
			}
		},'json');
	}

	function submit_code(){
		var codeData = {
			'contest_id': {$contest->contest_id},
			'problem_num': {$contest_problem->num},
			'language': $('#submit-language').val(),
			'code': $('#submit-source').val()
		};
		$.post('/api/solution/submit_contest_problem_code',codeData,function(d){
			if ('success' == d.status) {
				$('#error-info').html('');
				// 监控题目状态
				solution_id = d.data.solution_id;
				status_monitor();
			}else{
				$('#error-info').html(d.msg + " @ " + getNowFormatDate());
			}
		},'json');
		return false;
	}
</script>
{/block}
