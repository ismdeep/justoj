{extend name="extra@themes/bootstrap/layout/user" /}
{block name="body"}
<div class="container">

	<div class="row">
		<div class="col-md-9">
			<?php $hr_flag = false;?>
			{volist name="newss" id="news"}
			<?php $news->fk(); ?>

			{if $hr_flag}<hr>{/if}<?php $hr_flag = true;?>

			<div>
				<h3>{$news->title}</h3>
				<p>{$news->content}</p>
				<!--<p>{$news->user->nick}({$news->user_id})</p>-->
			</div>
			{/volist}

			<!--<hr>-->

			<!--Choose the fastest JustOJ entrance for you:-->
			<!--<div>-->
			<!--<a href="http://oj.jxust.edu.cn">http://oj.jxust.edu.cn</a>-->
			<!--</div>-->
			<!--<div>-->
			<!--<a href="https://oj.ismdeep.com">https://oj.ismdeep.com</a>-->
			<!--</div>-->
		</div>

		<div class="col-md-3">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						近期比赛
					</h3>
				</div>
				{if sizeof($recent_contests) <= 0}
				<div class="panel-body">
					尚无比赛
				</div>
				{else}
				<ul class="list-group">
				{volist name="recent_contests" id="contest"}
				<li class="list-group-item">
					<p><a href="/contest?id={$contest->contest_id}">{$contest->title}</a></p>
					<p>开始于：{$contest->start_time}</p>
				</li>
				{/volist}
				</ul>
				{/if}
			</div>

			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						判题状态
					</h3>
				</div>
				<div class="panel-body">
					<table class="table">
						<thead>
						<tr>
							<th>状态</th>
							<th>数量</th>
						</tr>
						</thead>
						<tbody>
						<tr>
							<td>等待判题</td>
							<td id="pending_cnt"></td>
						</tr>
						<tr>
							<td>正在运行</td>
							<td id="running_cnt"></td>
						</tr>
						<tr>
							<td>答案正确</td>
							<td id="ac_cnt" style="color: green"></td>
						</tr>
						<tr>
							<td>未通过</td>
							<td id="not_ac_cnt" style="color: red"></td>
						</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	function fetch_data() {
		$.get('/api/info/solution_statistics', function(d){
			console.log(d);
			$('#pending_cnt').html(d.pending_cnt + d.rejudging_cnt);
			$('#running_cnt').html(d.running_cnt + d.compiling_cnt);
			$('#ac_cnt').html(d.ac_cnt);
			$('#not_ac_cnt').html(d.pe_cnt + d.wa_cnt + d.tle_cnt + d.mle_cnt + d.ole_cnt + d.re_cnt + d.ce_cnt);
		}, 'json');
	}
	$(function(){
		fetch_data();
		setInterval(function(){
			fetch_data();
		}, 1000);
	});
</script>
{/block}