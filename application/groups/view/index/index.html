{extend name="extra@layout/user" /}
{block name='titlepart'}{$lang['allgroup']} :: Welcome to JustOJ{/block}
{block name="body"}
<div class="container">
	<table class="table table-hover">
		<thead>
		<tr>
			<th width="40%">{$lang.name}</th>
			<th width="35%">{$lang.teacher}</th>
			<th width="10%">{$lang.operation}</th>
		</tr>
		</thead>
		<tbody>
		{volist name='groups' id='group'}
		<?php $group->fk();?>
		<tr>
			<td><a href="/group?id={$group->id}">{if 1 == $group->type}<span class="glyphicon glyphicon-lock text-danger"></span>&nbsp;{/if}{$group->name}</a></td>
			<td>{$group->ownner_id}({$group->teacher->nick})</td>
			<td>
				{if $group->loginuser_group_join}

				{if 0 == $group->loginuser_group_join->status}
				{$lang.waiting_for_verify}
				{/if}

				{if 1 == $group->loginuser_group_join->status}
				<a class="btn btn-sm btn-success" href="/group?id={$group->loginuser_group_join->group_id}">{$lang.enter}</a>
				{/if}

				{if 2 == $group->loginuser_group_join->status}
				<span class="label label-danger">{$lang.removed}</span>
				{/if}

				{if 3 == $group->loginuser_group_join->status}
				<span class="label label-danger">{$lang.rejected}</span>
				{/if}

				{else}
				<!--<a class="btn btn-sm btn-default" href="javascript:;" onclick="request_join('{$group->id}')">{$lang.join}</a>-->
				<a class="btn btn-sm btn-default" href="/group/Join?id={$group->id}">{$lang.join}</a>
				{/if}
			</td>
		</tr>
		{/volist}
		</tbody>
	</table>
	{$groups->render()}
</div>


<script type="text/javascript">
function request_join(group_id){
    layer.confirm('确定申请加入此班级？',function(index){
        layer.close(index);
        var data = {
            'group_id': group_id
		};
        $.post('/api/Group/join',data,function(d){
            if ('success' == d.status) {
                location.reload();
			}else{
                layer.alert(d.msg);
			}
		},'json');
	});
}
</script>
{/block}
