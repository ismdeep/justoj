{extend name="extra@layout/user" /}

{block name='titlepart'}{$lang['login']} - {$lang['justoj']}{/block}

{block name="navpart"}
{/block}


{block name="body"}

<div class="container" style="margin-top: 80px;width:400px">
    <ul class="nav nav-tabs">
        <li class="active">
            <a href="javascript:;">
                {$lang.login}
            </a>
        </li>
        <li><a href="/register">{$lang.register}</a></li>
    </ul>
    <br>
    <form class="form-horizontal" role="form" id="loginForm" action="/login/Post" method="post">
        <div class="form-group">
            <label for="username" class="col-sm-4 control-label">{$lang.username}</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="username" name="username"
                       placeholder="{$lang.please_input_username}">
            </div>
        </div>
        <div class="form-group">
            <label for="password" class="col-sm-4 control-label">{$lang.password}</label>
            <div class="col-sm-8">
                <input type="password" class="form-control" id="password" name="password"
                       placeholder="{$lang.please_input_password}">
            </div>
        </div>
        <div hidden>
            <input type="text" name="redirect" value="{$redirect}">
        </div>
        <div class="form-group">
            <div class="col-sm-offset-4 col-sm-8">
                <button type="submit" class="btn btn-success">{$lang.login}</button>
                <!--&nbsp;&nbsp;&nbsp;&nbsp;<a class="btn btn-default" href="/register">{$lang.goto_register}</a>-->
            </div>
        </div>
    </form>
</div>

<script type="text/javascript">
    $('#loginForm').on('submit', function () {
        console.log('hello');
        $.post('/api/login/login', $('#loginForm').serialize(), function (d) {
            console.log(d);
            if ('success' == d.status) {
                layer.alert(d.msg, function () {
                    console.log('login successfully');
                    localStorage.setItem('username', $('#username').val());
                    localStorage.setItem('password', $('#password').val());
                    location.href = '{$redirect}';
                    layer.closeAll();
                });
            } else {
                layer.alert(d.msg);
            }
        });
        return false;
    });

    $(function(){
        $('#username').val( localStorage.getItem('username') );
        $('#password').val( localStorage.getItem('password') );
    });
</script>

{/block}
